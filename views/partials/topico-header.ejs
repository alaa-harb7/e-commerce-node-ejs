    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <header class="topico-header">
        <div class="header-container">
            <!-- Logo -->
            <div class="logo">
                <a href="/" style="text-decoration: none; color: inherit;">
                    <span class="logo-text">TOPIC<span class="logo-dot">O</span></span>
                </a>
            </div>
            
            <!-- Search Bar -->
            <div class="search-section">
                <form action="/products" method="GET" style="display: flex; width: 100%;">
                    <input type="text" name="keyword" class="search-input" placeholder="Search For Products...">
                    <button type="submit" class="search-btn">Search</button>
                </form>
            </div>
            
            <!-- User Actions -->
            <div class="user-actions">
                <a href="/wishlist" class="wishlist-icon" style="text-decoration: none; color: inherit; margin-right: 15px; display: flex; align-items: center;" title="My Wishlist">
                    <i class="fas fa-heart" style="font-size: 1.2rem;"></i>
                </a>
                <a href="/cart" class="cart-icon" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge"><%= (typeof cart !== 'undefined' && cart && cart.cartItems) ? cart.cartItems.length : 0 %></span>
                    <div class="cart-info">
                        <span class="cart-label">My Cart</span>
                        <span class="cart-price">$<%= (typeof cart !== 'undefined' && cart) ? (cart.totalPriceAfterDiscount !== undefined ? cart.totalPriceAfterDiscount : cart.totalCartPrice) : 0 %></span>
                    </div>
                </a>
                <% if (typeof user !== 'undefined' && user) { %>
                    <a href="/users/me" class="btn-login"><i class="fas fa-user-circle"></i>
                        <% if (user.role === 'admin') { %>
                            <span class="admin-badge">Admin</span>
                        <% } %>
                        <% if (user.role === 'user') { %>
                            <span class="user-badge"><%= user.name %></span>
                        <% } %>
                    </a>
                    <a href="#" onclick="confirmLogout(event)" class="btn-signup">Logout</a>
                    
                     <!-- Sticky Chat Button -->
                    <a href="<%= user.role === 'admin' ? '/admin/chats' : '/chat' %>" class="chat-sticky-btn" title="Chat with Support">
                        <i class="fas fa-comment-dots"></i>
                        <% if (typeof unreadCount !== 'undefined' && unreadCount > 0) { %>
                            <span class="chat-badge" id="chatBadge"><%= unreadCount %></span>
                        <% } else { %>
                            <span class="chat-badge" id="chatBadge" style="display: none;">0</span>
                        <% } %>
                    </a>
                    

                <% } else { %>
                    <a href="/auth/login" class="btn-login">login <i class="fas fa-arrow-right"></i></a>
                    <a href="/auth/signup" class="btn-signup"><i class="fas fa-user"></i> sign up</a>
                <% } %>
            </div>
        </div>
    </header>
    <script>
    function confirmLogout(event) {
        event.preventDefault();
        Swal.fire({
            title: 'Are you sure?',
            text: "Do you want to logout?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#FFD700',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, logout!',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/auth/logout';
            }
        });
    }
    </script>
    
    <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            // Global Admin Socket
            if (!window.appSocket) {
                window.appSocket = io({ 
                    withCredentials: true,
                    transports: ['websocket', 'polling'] 
                });

                window.appSocket.on('connect', () => {
                    console.log('Global Admin Socket Connected');
                });

                window.appSocket.on('adminNotification', (data) => {
                    console.log("Global Admin Notification:", data);
                    
                    // Increment badge
                    const badge = document.getElementById('chatBadge');
                    if(badge) {
                        let count = parseInt(badge.innerText) || 0;
                        badge.innerText = count + 1;
                        badge.style.display = 'flex'; // Ensure it's visible (flex to center text)
                    }

                    // Don't show notification if we are already on the specific chat details page
                    // We can check the URL
                    const currentPath = window.location.pathname;
                    if (currentPath.includes(`/admin/chats/${data.userId}`)) {
                        return;
                    }

                    const audio = new Audio('/audio/notification.mp3'); // Optional: Add sound if available
                    // navigate to user chat
                    Swal.fire({
                        title: 'New Message',
                        text: `From ${data.userName}: ${data.content}`,
                        icon: 'info',
                        showCancelButton: true,
                        confirmButtonText: 'Reply',
                        cancelButtonText: 'Dismiss',
                        toast: true,
                        position: 'top-end',
                        timer: 10000,
                        timerProgressBar: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = `/admin/chats/${data.userId}`;
                        }
                    });
                });
            }
        </script>
    <% } %>
